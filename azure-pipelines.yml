# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: ubuntu-latest

variables:
- group: GitHub
  github_repo: 'shotalinux/IaC-Library'
  branch_name: 'feature-branch'
  pr_title: 'Automated PR from Azure DevOps'
  pr_body: 'This is an automated PR created by Azure DevOps pipeline.'

steps:
- checkout: self
- script: |
    git config --global user.name "Azure DevOps"
    git config --global user.email "akhalaiashota@outlook.com"
    git remote add github https://shotalinux:${{ $GITHUB_PAT }}@github.com/${{ variables.github_repo }}.git
  displayName: 'Set up Git and GitHub credentials'

- script: |
    git checkout -b ${{ variables.branch_name }}
    git push github ${{ variables.branch_name }}
  displayName: 'Create and push branch to GitHub'

- script: |
    curl -X POST -H "Authorization: token ${{ $GITHUB_PAT }}" \
    -d '{"title": "${{ variables.pr_title }}", "body": "${{ variables.pr_body }}", "head": "${{ variables.branch_name }}", "base": "main"}' \
    https://api.github.com/repos/${{ variables.github_repo }}/pulls
  displayName: 'Create Pull Request in GitHub'
